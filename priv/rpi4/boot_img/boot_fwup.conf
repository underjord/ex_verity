define(OFFSET, 0)
# sizing is in 512 byte blocks
define(COUNT, 51232)

file-resource bcm2711-rpi-cm4.dtb { host-path = "${SOURCE}/bcm2711-rpi-cm4.dtb" }
file-resource bcm2711-rpi-4-b.dtb { host-path = "${SOURCE}/bcm2711-rpi-4-b.dtb" }
file-resource bcm2711-rpi-400.dtb { host-path = "${SOURCE}/bcm2711-rpi-400.dtb" }
file-resource config.txt { host-path = "${CONFIG_TXT}" }
file-resource cmdline.txt { host-path = "${CMDLINE_TXT}" }
file-resource Image { host-path = "${SOURCE}/Image" }
file-resource rootfs.cpio.gz { host-path = "${ROOTFS}" }
file-resource ramoops.dtb { host-path = "${SOURCE}/ramoops.dtb" }
file-resource rootfs_public.pem { host-path = "${ROOTFS_PUB_KEY}" }
file-resource fixup4x.dat { host-path = "${SOURCE}/rpi-firmware/fixup4x.dat" }
file-resource start4x.elf { host-path = "${SOURCE}/rpi-firmware/start4x.elf" }
file-resource overlay_map.dtb { host-path = "${SOURCE}/rpi-firmware/overlays/overlay_map.dtb" } 
file-resource rpi-ft5406.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/rpi-ft5406.dtbo" }
file-resource rpi-backlight.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/rpi-backlight.dtbo" }
file-resource w1-gpio-pullup.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/w1-gpio-pullup.dtbo" }
file-resource miniuart-bt.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/miniuart-bt.dtbo" }
file-resource vc4-kms-v3d.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/vc4-kms-v3d.dtbo" }
file-resource vc4-kms-v3d-pi4.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/vc4-kms-v3d-pi4.dtbo" }
file-resource vc4-kms-dsi-7inch.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/vc4-kms-dsi-7inch.dtbo" }
file-resource tc358743.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/tc358743.dtbo" }
file-resource dwc2.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/dwc2.dtbo" }
file-resource imx219.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/imx219.dtbo" }
file-resource imx296.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/imx296.dtbo" }
file-resource imx477.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/imx477.dtbo" }
file-resource imx708.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/imx708.dtbo" }
file-resource ov5647.dtbo { host-path = "${SOURCE}/rpi-firmware/overlays/ov5647.dtbo" }

task complete {
    on-init {
        fat_mkfs(${OFFSET}, ${COUNT})
        fat_setlabel(${OFFSET}, "BOOT")
        fat_mkdir(${OFFSET}, "rpi-firmware")
        fat_mkdir(${OFFSET}, "rpi-firmware/overlays")
    }

    on-resource bcm2711-rpi-cm4.dtb { fat_write(${OFFSET}, "bcm2711-rpi-cm4.dtb") }
    on-resource bcm2711-rpi-4-b.dtb { fat_write(${OFFSET}, "bcm2711-rpi-4-b.dtb") }
    on-resource bcm2711-rpi-400.dtb { fat_write(${OFFSET}, "bcm2711-rpi-400.dtb") }
    on-resource config.txt { fat_write(${OFFSET}, "config.txt") }
    on-resource cmdline.txt { fat_write(${OFFSET}, "cmdline.txt") }
    on-resource Image { fat_write(${OFFSET}, "Image") }
    on-resource rootfs.cpio.gz { fat_write(${OFFSET}, "rootfs.cpio.gz") }
    on-resource ramoops.dtb { fat_write(${OFFSET}, "ramoops.dtb") }
    on-resource rootfs_public.pem { fat_write(${OFFSET}, "rootfs_public.pem") }
    on-resource fixup4x.dat { fat_write(${OFFSET}, "fixup4x.dat") }
    on-resource start4x.elf { fat_write(${OFFSET}, "start4x.elf") }
    on-resource overlay_map.dtb { fat_write(${OFFSET}, "overlay_map.dtb") } 
    on-resource rpi-ft5406.dtbo { fat_write(${OFFSET}, "rpi-ft5406.dtbo") }
    on-resource rpi-backlight.dtbo { fat_write(${OFFSET}, "rpi-backlight.dtbo") }
    on-resource w1-gpio-pullup.dtbo { fat_write(${OFFSET}, "w1-gpio-pullup.dtbo") }
    on-resource miniuart-bt.dtbo { fat_write(${OFFSET}, "miniuart-bt.dtbo") }
    on-resource vc4-kms-v3d.dtbo { fat_write(${OFFSET}, "vc4-kms-v3d.dtbo") }
    on-resource vc4-kms-v3d-pi4.dtbo { fat_write(${OFFSET}, "vc4-kms-v3d-pi4.dtbo") }
    on-resource vc4-kms-dsi-7inch.dtbo { fat_write(${OFFSET}, "vc4-kms-dsi-7inch.dtbo") }
    on-resource tc358743.dtbo { fat_write(${OFFSET}, "tc358743.dtbo") }
    on-resource dwc2.dtbo { fat_write(${OFFSET}, "dwc2.dtbo") }
    on-resource imx219.dtbo { fat_write(${OFFSET}, "imx219.dtbo") }
    on-resource imx296.dtbo { fat_write(${OFFSET}, "imx296.dtbo") }
    on-resource imx477.dtbo { fat_write(${OFFSET}, "imx477.dtbo") }
    on-resource imx708.dtbo { fat_write(${OFFSET}, "imx708.dtbo") }
    on-resource ov5647.dtbo { fat_write(${OFFSET}, "ov5647.dtbo") }
}